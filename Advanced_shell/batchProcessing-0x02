#!/bin/bash

# List of Pokémon to fetch
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Base API URL
API_URL="https://pokeapi.co/api/v2/pokemon"

# Loop through each Pokémon
for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."

    success=false

    # Retry up to 3 times
    for attempt in {1..3}; do
        echo "Attempt $attempt for $pokemon..."
        
        # Make API request and capture HTTP status
        status_code=$(curl -s -o "${pokemon}.json" -w "%{http_code}" "$API_URL/$pokemon")

        if [ "$status_code" -eq 200 ]; then
            echo "✅ Successfully saved ${pokemon}.json"
            success=true
            break
        else
            echo "⚠️ Request failed with status $status_code (attempt $attempt)"
            sleep 2  # short delay before retry
        fi
    done

    # If all attempts failed, log error
    if [ "$success" = false ]; then
        echo "❌ Failed to fetch $pokemon after 3 attempts" >> errors.txt
        rm -f "${pokemon}.json"  # remove incomplete file
    fi

    # Delay to avoid rate-limiting between different Pokémon
    sleep 2
done

